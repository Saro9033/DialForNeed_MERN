import{k as b,r as p,O as k,v as S,Z as I,n as u,s as j,ah as E,am as O,an as w,j as o,ao as C,ap as N,aq as R}from"./index-B9-9R2Yl.js";import{C as q}from"./CheckOutSteps-CquyRHO_.js";const K=t=>new Promise(n=>{const e=document.createElement("script");e.src=t,e.onload=()=>{n(!0)},e.onerror=()=>{n(!1)},document.body.appendChild(e)}),F=()=>{const{enqueueSnackbar:t}=b(),{rzpKey:n}=p.useContext(k),e=S(),g=I(),c=JSON.parse(sessionStorage.getItem("orderInfo")),a=u(j),v=u(E),m=u(O),[y,A]=p.useState(""),i=c==null?void 0:c.totalPrice,s=parseInt(i==null?void 0:i.replace("â‚¹","").replace(/,/g,""));console.log(s);const x=async()=>{try{return await K("https://checkout.razorpay.com/v1/checkout.js")?!0:(t("Razorpay SDK failed to load. Please check your internet connection.'",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}}),!1)}catch(r){return console.error("Failed to load Razorpay SDK:",r),!1}},z=async()=>{if(!await x())return;const l={key:n,amount:s*100,currency:"INR",name:a.name,description:"Payment for your order",image:a.avatar,handler:d=>{P()},prefill:{name:a.name,email:a.email,contact:a.phoneNumber},theme:{color:"#3399cc"}};new window.Razorpay(l).open()},P=async()=>{try{const{data:r}=await C.post("/payment/process",{amount:s}),l=r.clientSecret,h=v.map(f=>({productId:f.productId,quantity:f.quantity})),d={totalPrice:s,orderItems:h,paymentInfo:{id:l,status:"success"}};console.log(d),await e(N(d)),e(R()),g("/payment-success"),t("Payment successfull and Your Items ordered!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch{t("Failed to submit payment to backend. Please try again later.",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return p.useEffect(()=>{if(m){t(m,{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"},onExited:()=>{e(w())}});return}},[]),o.jsxs("div",{className:"container",style:{minHeight:"100vh"},children:[o.jsx(q,{payment:!0}),o.jsx("div",{className:"d-flex align-items-center justify-content-center ",children:o.jsx("button",{className:"btn btn-primary",onClick:z,children:"Pay with Razorpay"})}),y&&o.jsx("p",{style:{color:"red"},children:y})]})};export{F as default};
